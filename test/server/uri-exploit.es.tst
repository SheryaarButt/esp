/*
    uri-exploit.tst - Test HTML injection in URI
 */

const HTTP = tget('TM_HTTP') || "127.0.0.1:5100"
let http: Http = new Http

let caught
try {
    http.get(HTTP + "/directives.esp?weather=sunny&exploit=<html>")
    ttrue(http.status == 400)
} catch {
    caught = true
}
ttrue(caught)
http.close()


//  Bypass http to send the request to the server

let s = new Socket
s.connect(HTTP)
s.write("GET /directives.esp?weather=sunny&exploit=<html> HTTP/1.0\r\n\r\n")
let response = new ByteArray
while ((n = s.read(response, -1)) != null) {}
let r = response.toString()
ttrue(r.indexOf('Bad Request') >= 0)
s.close()
